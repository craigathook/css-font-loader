{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/alpha-jpeg.js","src/utils/AlphaJPEG.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"alpha-jpeg.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var AlphaJPEGModule = require('./utils/AlphaJPEG');\r\n\r\nwindow.AlphaJPEG = AlphaJPEGModule;","function AlphaJPEG(){\r\n  var self = this;\r\n  \r\n  self.load = function(target, src, options) {\r\n    \r\n    var onComplete = function(){};\r\n    if(typeof target == 'string') {\r\n        target = document.querySelector(target);\r\n    }\r\n    var pixelRatio = 1;\r\n    var renderer = \"svg\";\r\n    if(!options){\r\n      options = {};\r\n    }\r\n    \r\n    if( options.hasOwnProperty('onComplete') ) {\r\n      onComplete = options.onComplete;\r\n    }\r\n    if( options.hasOwnProperty('pixelRatio') ) {\r\n      pixelRatio = options.pixelRatio;\r\n    }\r\n    if( options.hasOwnProperty('renderer') ) {\r\n      renderer = options.renderer;\r\n    }\r\n    //console.log('AlphaJPEG init');\r\n    var canvas = document.createElement('canvas');\r\n    var htmlImage = document.createElement('img');\r\n    var imgContainer = document.createElement('div');\r\n    var container = document.createElement('div');\r\n    htmlImage.crossOrigin = \"Anonymous\";\r\n    htmlImage.src = src;\r\n\r\n    if(renderer == \"svg\") {\r\n      \r\n      htmlImage.onload = function(){\r\n        \r\n        var w = htmlImage.width;\r\n        var h = htmlImage.height;\r\n\r\n        container.style.width = w/2/pixelRatio + 'px';\r\n        container.style.height = h/pixelRatio + 'px';\r\n\r\n        imgContainer.style.position = 'relative';\r\n        imgContainer.style.transform = 'scale('+ (1/pixelRatio) +')';\r\n        imgContainer.style.transformOrigin = 'top left';\r\n        imgContainer.style.webkitTransform = 'scale('+ (1/pixelRatio) +')';\r\n        imgContainer.style.webkitTransformOrigin = 'top left';\r\n        imgContainer.style.width = (w/2) + 'px';\r\n        imgContainer.style.height = h + 'px';\r\n        imgContainer.style.overflow = 'hidden';\r\n        imgContainer.style.opacity = '0.999999'; // this really shouldn't be necessary, but it is.\r\n\r\n        var svgW = w/2;\r\n        var svgH = h;\r\n        var imgW = w;\r\n        var imgH = h;\r\n        var imgSrc = src;\r\n\r\n        var date = new Date();\r\n        var msTime = date.getTime();\r\n\r\n        var safeAssetName = imgSrc.split('/')[imgSrc.split('/').length-1].replace(/[|&\\-;$%@_.\"<>=()+,]/g, \"\");\r\n\r\n        var maskName = 'imageMask'+safeAssetName;\r\n        var imageName = 'imageSource'+safeAssetName;\r\n\r\n        var svgElement = '<svg id=\"'+safeAssetName+'\" preserveAspectRatio=\"none\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 ' + svgW + ' ' + svgH + '\" class=\"svg-elem\"><defs><mask id=\"'+maskName+'\"><image id=\"'+imageName+'\" width=\"' + imgW + '\" height=\"' + imgH + '\" xlink:href=\"' + imgSrc + '\" x=\"-' + svgW + '\"></image></mask></defs><image mask=\"url(#'+maskName+')\" id=\"sourceImage\" width=\"' + imgW + '\" height=\"' + imgH + '\" xlink:href=\"' + imgSrc + '\"></image></svg>';\r\n\r\n        imgContainer.innerHTML = svgElement;\r\n\r\n        var svgDom = imgContainer.children[0];\r\n        if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {\r\n          svgDom.onload = function(){\r\n            //console.log('AlphaJPEG Load Complete \\(Safari\\).');\r\n            onComplete(svgDom);\r\n          };\r\n        } else {\r\n          //console.log('AlphaJPEG Load Complete.');\r\n          onComplete(svgDom);\r\n        }\r\n        container.appendChild(imgContainer);\r\n        target.appendChild(container);\r\n      }\r\n    }\r\n    \r\n    if(renderer == \"canvas\") {\r\n      \r\n      htmlImage.onload = function(){\r\n        \r\n        var w = htmlImage.width;\r\n        var h = htmlImage.height;\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n\r\n        canvas.style.width = w/pixelRatio+\"px\";\r\n        canvas.style.height = h/pixelRatio+\"px\";\r\n\r\n        imgContainer.style.width = w/2/pixelRatio + 'px';\r\n        imgContainer.style.height = h/pixelRatio + 'px';\r\n        imgContainer.style.overflow = 'hidden';\r\n\r\n        var ctx = canvas.getContext(\"2d\");\r\n\r\n        ctx.drawImage(htmlImage, 0, 0);\r\n\r\n        var imageData = ctx.getImageData(0, 0, w/2, h);\r\n        var imagePixels = imageData.data;\r\n        var maskData = ctx.getImageData(w/2, 0, w/2, h);\r\n        var maskPixels = maskData.data;\r\n\r\n        for (var i = 0, n = imagePixels.length; i < n; i += 4) {\r\n          var alpha = maskPixels[i];\r\n          imagePixels[i + 3] = alpha;\r\n        }\r\n\r\n        ctx.putImageData(imageData, 0, 0);\r\n        imgContainer.appendChild(canvas);\r\n        target.appendChild(imgContainer);\r\n        onComplete(imgContainer);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = new AlphaJPEG();"]}